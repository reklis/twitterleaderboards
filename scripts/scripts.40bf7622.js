"use strict";angular.module("LinkboardApp.config",[]).constant("environment","production").constant("apiroot","http://api.twitterleaderboards.com"),angular.module("LinkboardApp",["LinkboardApp.config","ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/linkboard/:lbid",{templateUrl:"views/leaderboarddetail.html",controller:"LeaderboardDetailCtrl"}).when("/pub/:pubid",{templateUrl:"views/pub.html",controller:"PubCtrl"}).when("/tweets/:user_id/:leaderboard_id/:encoded_url",{templateUrl:"views/tweets.html",controller:"TweetsCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location",function(a,b){a.timewindows=[{name:"lasthour",timewindow:36e5},{name:"lastday",timewindow:864e5}],a.prettyUrl=function(a){try{var b=purl(a);return b.attr("host")+" "+b.attr("path").replace(/\//g," ")}catch(c){return a.split("/").filter(function(a){return a&&a.length>1&&a.length<100}).join(" ").replace(/.*?:/,"").replace(/%[\w\n]+/g," ").replace(/[\?,=,_,~]/g," ").replace(/.htm/,"")}},a.prettyTime=function(a){return moment(a).fromNow()},a.showTw=function(a,c,d){var e=encodeURIComponent(d._id);b.path("/tweets/"+a+"/"+c+"/"+e)},a.goHome=function(){b.path("/")}}]),angular.module("LinkboardApp").factory("leaderboard",["$resource","apiroot",function(a,b){return a("",{},{user:{method:"JSONP",url:b+"/user?callback=JSON_CALLBACK"},results:{method:"JSONP",url:b+"/lb/:leaderboard_id/?callback=JSON_CALLBACK",params:{leaderboard_id:"@id"}},pubresults:{method:"JSONP",url:b+"/pub/:pub_id?callback=JSON_CALLBACK",params:{pub_id:"@id"}},remove:{method:"JSONP",url:b+"/lb/:leaderboard_id/remove?callback=JSON_CALLBACK",params:{leaderboard_id:"@id"}},create:{method:"JSONP",url:b+"/lb/create?callback=JSON_CALLBACK",params:{name:"@name",topics:"@topics",domains:"@domains"}},publish:{method:"JSONP",url:b+"/lb/:leaderboard_id/publish?callback=JSON_CALLBACK",params:{leaderboard_id:"@id"}},unpublish:{method:"JSONP",url:b+"/lb/:leaderboard_id/unpublish?callback=JSON_CALLBACK",params:{leaderboard_id:"@id"}},tweets:{method:"JSONP",url:b+"/tweets/:user_id/:leaderboard_id/:encoded_url?callback=JSON_CALLBACK",params:{user_id:"@user_id",leaderboard_id:"@leaderboard_id",encoded_url:"@encoded_url"}},recent:{method:"JSONP",url:b+"/recent?callback=JSON_CALLBACK"}})}]),angular.module("LinkboardApp").controller("MainCtrl",["$scope","apiroot","leaderboard",function(a,b,c){a.maxlbs=4,a.loading=!0,a.twitterLoginUrl=b+"/auth/twitter",a.twitterLogoutUrl=b+"/logout",a.mostrecent=[],a.fetchUser=function(){c.user().$promise.then(function(b){a.auth=b,a.auth&&a.auth.user?(a.user=a.auth.user,a.user.leaderboards||(a.user.leaderboards=[])):a.notloggedin=!0,a.loading=!1},function(b){console.error(b),a.login_error="Login failed",a.loading=!1})},a.fetchRecent=function(){c.recent().$promise.then(function(b){a.mostrecent=b.recent,console.dir(b)},function(a){console.error(a)})},a.showCreateLbForm=function(){a.newlb={},$("#create-lb-modal").modal("show")},$("#create-lb-modal").on("shown.bs.modal",function(){$("#input-lbname").focus()}),a.parseRawName=function(){var b,c=a.newlb.rawname,d=c.match(/[\w,\-, \n]+/);b=d&&d.length?d[0]:null,b&&b.length&&(b=b.substring(0,32)),a.newlb.name=b},a.parseRawKeywords=function(){try{a.newlb.topics=_.chain(a.newlb.rawkeywords.split(/[\s,\,]/)).map(function(a){return a.substring(0,32)}).compact().uniq().value()}catch(b){a.newlb.topics=[]}},a.parseRawDomains=function(){try{a.newlb.domains=_.chain(a.newlb.rawdomains.split(/[\s,\,]/)).map(function(a){return a.substring(0,32)}).compact().uniq().value()}catch(b){a.newlb.domains=[]}},a.validName=function(){var b=a.newlb?a.newlb.name:null;return b&&b.length},a.validKeywords=function(){var b=a.newlb?a.newlb.topics:null;return b&&b.length&&b.length<9},a.validDomains=function(){var b=a.newlb?a.newlb.domains:null;return b&&b.length&&b.length<9},a.formValid=function(){return a.validName()&&a.validKeywords()&&a.validDomains()},a.createLb=function(){a.formValid()&&(a.creatingLb=!0,c.create(a.newlb,function(){a.creatingLb=!1,a.fetchUser(),$("#create-lb-modal").modal("hide")}))},a.restartStream=function(){c.restart(function(){a.fetchUser()})},a.fetchUser(),a.fetchRecent()}]),angular.module("LinkboardApp").controller("AboutCtrl",["$scope",function(a){a.contactInfo={twitterhandle:"sfusco",githubrepo:"https://github.com/reklis/twitterleaderboards"},a.steps=[{icon:"user",text:"Login with Twitter"},{icon:"bookmark",text:"Mark domains you want to watch"},{icon:"dashboard",text:"Links shared on twitter are detected, counted and ranked"},{icon:"heart",text:"Discover new stuff to love :)"}],a.services=[{href:"https://twitter.com/twitter",name:"twitter"},{href:"https://twitter.com/awscloud",name:"amazon aws"},{href:"https://twitter.com/heroku",name:"heroku"},{href:"https://twitter.com/getiron",name:"iron.io"},{href:"https://twitter.com/mongohq",name:"mongohq"},{href:"https://twitter.com/mongolab",name:"mongolab"},{href:"https://twitter.com/RedisLabsInc",name:"redis labs"},{href:"https://twitter.com/github",name:"github"}]}]),angular.module("LinkboardApp").controller("LeaderboardDetailCtrl",["$scope","$rootScope","$routeParams","$location","$timeout","leaderboard",function(a,b,c,d,e,f){a.loading=!0,a.sharingLb=!1,a.unsharingLb=!1,a.deletingLb=!1,a.lbid=c.lbid,f.results(null,{id:a.lbid}).$promise.then(function(c){var d=b.timewindows[0];a.lbdetails=c,a.loading=!1,a.activetab=d.name,a.updatePublishUrl(a.lbdetails.lb.publish_key)},function(b){a.loading=!1,console.error(b),d.path("/")}),a.updatePublishUrl=function(b){var c=window.location;a.publish_url=b?c.protocol+"//"+c.host+"/#/pub/"+b:null},a.confirmDeleteLb=function(){$("#confirm-delete-modal").modal("show")},a.deleteLb=function(){a.deletingLb=!0,f.remove(null,{id:a.lbid},function(){a.deletingLb=!1,$("#confirm-delete-modal").modal("hide"),e(function(){d.path("/")},1e3)})},a.confirmShareLb=function(){$("#confirm-share-modal").modal("show")},a.shareLb=function(){var b;a.sharingLb=!0,b=f.publish(null,{id:a.lbid},function(){a.updatePublishUrl(b.publish_key),a.sharingLb=!1,$("#confirm-share-modal").modal("hide")})},a.confirmUnShareLb=function(){$("#confirm-unshare-modal").modal("show")},a.unshareLb=function(){a.unsharingLb=!0,f.unpublish(null,{id:a.lbid},function(){a.updatePublishUrl(),a.unsharingLb=!1,$("#confirm-unshare-modal").modal("hide")})}}]),angular.module("LinkboardApp").controller("PubCtrl",["$rootScope","$scope","$routeParams","$location","$timeout","leaderboard",function(a,b,c,d,e,f){function g(){b.empty_animation_states=["┏ (-_-) ┛","┗ (-_-) ┓","┗ (-_-) ┛","┏ (-_-) ┓"],b.empty_animation_state_i=-1,b.animation_speed=500,h()}function h(){b.empty_animation_state_i++,b.empty_animation_state=b.empty_animation_states[b.empty_animation_state_i%b.empty_animation_states.length],e(h,b.animation_speed)}b.loading=!0,b.pubid=c.pubid,f.pubresults(null,{id:b.pubid}).$promise.then(function(c){var d=a.timewindows[0];b.lbdetails=c,b.activetab=d.name,b.loading=!1,c.rankings[d.timewindow]&&c.rankings[d.timewindow].length||g()},function(a){console.error(a),d.path("/")})}]),angular.module("LinkboardApp").controller("TweetsCtrl",["$scope","$routeParams","$location","leaderboard",function(a,b,c,d){a.loading=!0,a.encoded_url=b.encoded_url,a.decoded_url=decodeURIComponent(b.encoded_url),d.tweets(null,{user_id:b.user_id,leaderboard_id:b.leaderboard_id,encoded_url:a.encoded_url}).$promise.then(function(b){a.tweets=b.tweets.sort(function(a,b){var c=+moment(a.src.created_at),d=+moment(b.src.created_at);return c-d}),a.loading=!1},function(b){a.fetch_error=b,a.loading=!1})}]);